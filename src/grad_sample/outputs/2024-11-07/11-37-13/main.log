[2024-11-07 11:37:13,596][root][INFO] - ---------------------------------------------------------------
[2024-11-07 11:37:13,597][root][INFO] - Env:
CUDA_VISIBLE_DEVICES: null
PYTHONOPTIMIZE: null

[2024-11-07 11:37:13,597][root][INFO] - Command line args:
ansatz.alpha=5
chunk_size_vmap=2
[2024-11-07 11:37:13,597][root][INFO] - ---------------------------------------------------------------
[2024-11-07 11:37:13,599][root][INFO] - Run config:
device: '4'
solver_fn:
  _target_: netket.optimizer.solver.cholesky
lr: 0.001
diag_shift: 1.0e-10
n_iter: 2000
chunk_size_jac: 2
chunk_size_vmap: 2
save_every: 10
base_path: /scratch/.amisery/grad_sample/
model:
  _target_: grad_sample.models.ising.TFI
  L: 3
  h: 1.0
ansatz:
  _target_: netket.models.RBM
  alpha: 5
  param_dtype: complex
task:
  _target_: grad_sample.tasks.fullsum_analysis.FullSumPruning

[2024-11-07 11:37:13,599][root][INFO] - ---------------------------------------------------------------
[2024-11-07 11:37:18,849][jax._src.xla_bridge][INFO] - Unable to initialize backend 'rocm': module 'jaxlib.xla_extension' has no attribute 'GpuAllocatorConfig'
[2024-11-07 11:37:18,850][jax._src.xla_bridge][INFO] - Unable to initialize backend 'tpu': INTERNAL: Failed to open libtpu.so: libtpu.so: cannot open shared object file: No such file or directory
[2024-11-07 11:37:30,517][root][CRITICAL] - 'float' object cannot be interpreted as an integer
Traceback (most recent call last):
  File "/home/amisery/phd/tfi_gs_samples/grad_sample/src/grad_sample/main.py", line 50, in main
    task()
  File "/home/amisery/phd/tfi_gs_samples/grad_sample/src/grad_sample/tasks/fullsum_analysis.py", line 61, in __call__
    in_idx, fid_vals, dp_dist_ev, infid_ev = self.prune()
                                             ^^^^^^^^^^^^
  File "/home/amisery/phd/tfi_gs_samples/grad_sample/src/grad_sample/tasks/fullsum_analysis.py", line 221, in prune
    in_idx, fid_vals = self.get_change(jnp.arange(self.jacobian_orig.shape[0])) #compute infidelity change on entire basis
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/amisery/phd/tfi_gs_samples/grad_sample/src/grad_sample/tasks/fullsum_analysis.py", line 147, in get_change
    fid_vals = self.vmap_change(indices)
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/netket/jax/_vmap_chunked.py", line 35, in _eval_fun_in_chunks
    args_chunks = [
                  ^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/netket/jax/_vmap_chunked.py", line 36, in <listcomp>
    _get_chunks(a) if i in argnums else a for i, a in enumerate(args)
    ^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/netket/jax/_vmap_chunked.py", line 23, in _get_chunks
    x_chunks = jax.tree_util.tree_map(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/tree_util.py", line 344, in tree_map
    return treedef.unflatten(f(*xs) for xs in zip(*all_leaves))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/tree_util.py", line 344, in <genexpr>
    return treedef.unflatten(f(*xs) for xs in zip(*all_leaves))
                             ^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/netket/jax/_vmap_chunked.py", line 24, in <lambda>
    lambda x_: x_[: n_elements - n_rest, ...], x
               ~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/array.py", line 370, in __getitem__
    return lax_numpy._rewriting_take(self, idx)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/numpy/lax_numpy.py", line 11411, in _rewriting_take
    return _gather(arr, treedef, static_idx, dynamic_idx, indices_are_sorted,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/numpy/lax_numpy.py", line 11420, in _gather
    indexer = _index_to_gather(shape(arr), idx)  # shared with _scatter_update
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/numpy/lax_numpy.py", line 11665, in _index_to_gather
    start, step, slice_size = _preprocess_slice(i, x_shape[x_axis])
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/numpy/lax_numpy.py", line 11920, in _preprocess_slice
    stop = clamp_index(convert_to_index(s.stop), "stop")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/numpy/lax_numpy.py", line 11903, in clamp_index
    return core.min_dim(axis_size, i)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/core.py", line 2255, in min_dim
    d2 = concrete_dim_or_error(d2, "argument `d2` of `core.min_dim`")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/core.py", line 1580, in concrete_dim_or_error
    return concrete_or_error(operator.index, val, context=context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/.amisery/netket/lib/python3.11/site-packages/jax/_src/core.py", line 1573, in concrete_or_error
    return force(val)
           ^^^^^^^^^^
TypeError: 'float' object cannot be interpreted as an integer
